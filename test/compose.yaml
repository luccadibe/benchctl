services:
  ssh-test-1:
    image: linuxserver/openssh-server:latest
    container_name: benchctl-ssh-test-1
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - PUBLIC_KEY_FILE=/config/authorized_keys
      - SUDO_ACCESS=false
      - PASSWORD_ACCESS=false
      - USER_NAME=testuser
    volumes:
      - ./testdata/ssh/authorized_keys:/config/authorized_keys:ro
    ports:
      - "2222:2222"
    healthcheck:
      test: ["CMD-SHELL", "nc -z localhost 2222 || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 5

  ssh-test-2:
    image: linuxserver/openssh-server:latest
    container_name: benchctl-ssh-test-2
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - PUBLIC_KEY_FILE=/config/authorized_keys
      - SUDO_ACCESS=false
      - PASSWORD_ACCESS=false
      - USER_NAME=testuser
    volumes:
      - ./testdata/ssh/authorized_keys:/config/authorized_keys:ro
    ports:
      - "2223:2222"
    healthcheck:
      test: ["CMD-SHELL", "nc -z localhost 2222 || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 5

  ssh-server-with-app:
    image: linuxserver/openssh-server:latest
    container_name: benchctl-ssh-server-with-app
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - PUBLIC_KEY_FILE=/config/authorized_keys
      - SUDO_ACCESS=false
      - PASSWORD_ACCESS=false
      - USER_NAME=testuser
    volumes:
      - ./testdata/ssh/authorized_keys:/config/authorized_keys:ro
    ports:
      - "2224:2222"
      - "8080:8080"
    command: >
      bash -c "
        /init &
        nohup nc -lk -p 8080 > /dev/null 2>&1 &
        wait
      "
    healthcheck:
      test: ["CMD-SHELL", "nc -z localhost 2222 && nc -z localhost 8080 || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 5
